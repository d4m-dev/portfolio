<!doctype html>

<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>@d4m-dev • Personal Page</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#fafafa;color:#222;margin:0}
    .container{max-width:960px;margin:auto;padding:16px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
    header h1{font-size:22px}
    .feed{display:flex;flex-direction:column;gap:20px;margin-top:20px}
    .post{background:#fff;border:1px solid #ddd;border-radius:10px;overflow:hidden}
    .post-header{display:flex;align-items:center;padding:10px}
    .post-header img{width:40px;height:40px;border-radius:50%;margin-right:10px}
    .post img.media{width:100%;max-height:500px;object-fit:cover}
    .post video.media{width:100%;max-height:500px;border:none;outline:none}
    .post-actions{display:flex;align-items:center;gap:10px;padding:10px;font-size:18px}
    .post-actions i{cursor:pointer}
    .post-likes{font-weight:bold;padding:0 10px}
    .post-caption{padding:0 10px 10px 10px}
    .upload-section{background:#fff;padding:10px;border:1px solid #ddd;border-radius:10px;margin-bottom:20px}
    .upload-section input[type=file]{margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>@d4m-dev</h1>
      <button id="refresh">Refresh</button>
    </header><section class="upload-section">
  <h2>Đăng ảnh/video (Instagram-style)</h2>
  <input type="file" id="fileUpload" accept="image/*,video/*">
  <input type="text" id="caption" placeholder="Viết chú thích..." style="width:100%;margin-top:8px;padding:6px">
  <button id="uploadBtn" style="margin-top:10px">Đăng bài</button>
</section>

<section>
  <h2>Bảng tin</h2>
  <div id="feed" class="feed"></div>
</section>

  </div>  <script>
    const USER = 'd4m-dev';
    const OWNER = 'myname'; // repo chứa ảnh/video
    const REPO = 'myname';
    const BRANCH = 'main';
    const DIR = 'uploads';
    const TOKEN = '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'; // thêm token GitHub tại đây nếu muốn upload thật

    const feed = document.getElementById('feed');

    async function listMedia(){
      try{
        const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${DIR}?ref=${BRANCH}`;
        const res = await fetch(url, {headers: TOKEN?{Authorization:`Bearer ${TOKEN}`}:{}});
        if(!res.ok)return[];
        const files = await res.json();
        return files.filter(f=>/\.(jpg|jpeg|png|gif|mp4|webm)$/i.test(f.name));
      }catch{return[];}
    }

    function renderFeed(items){
      feed.innerHTML='';
      items.reverse().forEach(item=>{
        const ext=item.name.split('.').pop().toLowerCase();
        const caption = decodeURIComponent(item.name.split('_').slice(1).join('_').split('.')[0]);
        const div=document.createElement('div');
        div.className='post';
        div.innerHTML=`
          <div class="post-header">
            <img src="https://avatars.githubusercontent.com/${USER}" alt="pfp"><strong>${USER}</strong>
          </div>
          ${ext.match(/mp4|webm/)?`<video class="media" controls src="${item.download_url}"></video>`:`<img class="media" src="${item.download_url}" alt="post">`}
          <div class="post-actions">
            <i class="fa-regular fa-heart" onclick="toggleLike(this)"></i>
            <i class="fa-regular fa-comment"></i>
            <i class="fa-regular fa-paper-plane"></i>
          </div>
          <div class="post-likes">0 lượt thích</div>
          <div class="post-caption"><b>${USER}</b> ${caption}</div>`;
        feed.appendChild(div);
      });
    }

    function toggleLike(icon){
      const liked = icon.classList.toggle('fa-solid');
      const likesEl = icon.closest('.post').querySelector('.post-likes');
      let count=parseInt(likesEl.textContent)||0;
      likesEl.textContent = (liked?++count:--count)+' lượt thích';
    }

    async function uploadMedia(){
      const file=document.getElementById('fileUpload').files[0];
      const caption=document.getElementById('caption').value.trim()||'';
      if(!file){alert('Chọn tệp trước.');return;}
      if(!TOKEN){
        alert('Chưa có token GitHub, chỉ xem local.');
        const url=URL.createObjectURL(file);
        const fake={name:file.name,download_url:url};
        renderFeed([fake,...Array.from(feed.children).map(e=>e.dataset)]);
        return;
      }
      const reader=new FileReader();
      reader.onload=async()=>{
        const base64=reader.result.split(',')[1];
        const filename=`${Date.now()}_${encodeURIComponent(caption||'post')}.${file.name.split('.').pop()}`;
        const res=await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${DIR}/${filename}`,{
          method:'PUT',
          headers:{'Authorization':`Bearer ${TOKEN}`,'Content-Type':'application/json'},
          body:JSON.stringify({message:`upload ${filename}`,content:base64,branch:BRANCH})
        });
        if(res.ok){alert('Đã đăng!');loadFeed();}else alert('Lỗi upload');
      };
      reader.readAsDataURL(file);
    }

    async function loadFeed(){
      const items=await listMedia();
      renderFeed(items);
    }

    document.getElementById('uploadBtn').onclick=uploadMedia;
    document.getElementById('refresh').onclick=loadFeed;
    loadFeed();
  </script></body>
</html>
